# primus\~quintus

ランダムにプランを立てる。（0~5の登場回数はできるだけ均等にする）
観測結果についてそれがどの部屋だったのかを決め打ち、部屋のドアの行き先の度数分布を求める。これらのうち最頻のものを採用してグラフ（この時点では有向グラフだったり、情報が全くなく行き先が未確定のドアがあったりすることに注意）を作り、これがどれだけ有効解に近いかで評価し、焼きなます。
有効解か否かの条件は各ドアの行き先が一意に定まることと無向グラフにできること。
前者は、任意の部屋のドアの行き先候補の度数分布 $d$ について

$sum(d) - max(d) = 0$

が成り立つことと同値で、後者は、$e_{i,j} :=$ $i$→$j$ の有向辺の本数と定義すると、任意の部屋 $u$ について

$max( (\sum_{v \in V} max(e_{u,v}, e_{v,u})) - 6, 0 ) = 0$

が成り立つことと同値なので、これらの和を目的関数として最小化するように焼きなましを行った。
遷移は 1 つの観測結果に対応づけている部屋を別の部屋に振り替える操作で、差分更新により $O(SIZE)$ で評価できる。
部屋番号 0,1,2,3 の各部屋数の分布は固定されているようなので、番号 0 の部屋を番号 1 の部屋にするような遷移はやらない。
遷移候補は度数分布において 0 の個数が多いものを優先するようにすると、SIZE=30 でも 0.1 秒ほどで解が見つかる。

# aleph\~he
グラフは、サイズが半分のグラフを頂点倍加（各辺の接続先はランダム）して生成されている。
最初の explore で primus~quintus と同様の方法で、倍加前のグラフを特定する。
倍加後の辺のつなげ方は、一方の頂点だけ部屋番号を書き換えた後、倍加前のすべての辺を訪れれば特定できるので、TSP と中国人郵便配達問題（奇数次数頂点のマッチングは焼きなましで解いた）でプランを決めると、プラン長の制約に間に合う。

# vau\~iod

頂点倍加ではなく 3 倍加されている。
まずは、倍加前のグラフに自己ループが含まれていない場合の解法を考える。
最初の explore で primus~quintus と同様の方法で、倍加前のグラフを特定する。
順列 $P$ で、任意の異なる $u$, $v$ について $P_u \ne P_v$ が成り立つので、倍加前ではサイクルだが倍加後ではサイクルでなくなるパス p を 1 本見つけられれば、

  部屋番号書き換え（移動 a）
→ p の始点まで移動（移動 b）
→ p 上を辿る
→ 移動 b を逆再生
→ 部屋番号を書き換えつつ移動 a を逆再生
→ すべての辺を訪れる（移動 c）
→ p の始点まで移動（移動 d）
→ p 上を辿る
→ 移動 d を逆再生
→ 移動 c を逆再生

とすることで特定できる。プラン長にはかなり余裕がある。
パス p は、倍加前グラフのサイクルを適当に 1 つ選んで運ゲーをすれば追加の explore は不要。サイクルは2回訪れる必要があり、ここで別のサイクルを使うと成功確率は 4/9 だが、同じサイクルを使うと 5/9 になる。
ただし、自己ループでは逆再生がうまく行くとは限らないため、修正が必要になる。なのだが、時間がなかったため、このまま提出したらうまくいった。
